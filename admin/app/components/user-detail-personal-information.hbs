<section class="page-section mb_10">
  <UserDetailPersonalInformation::UserOverview
    @user={{@user}}
    @toggleDisplayAnonymizeModal={{this.toggleDisplayAnonymizeModal}}
  />
</section>

<section class="page-section mb_10 user-authentication-method">
  <header class="page-section__header">
    <h2 class="page-section__title">Méthodes de connexion</h2>
  </header>
  <div class="user-authentication-method__item" data-test-email>
    <div class="user-authentication-method-item__label">
      <span>Adresse e-mail</span>
      {{#if @user.hasEmailAuthenticationMethod}}
        <FaIcon @icon="check-circle" class="user-authentication-method-item__check" />
      {{else}}
        <FaIcon @icon="times-circle" class="user-authentication-method-item__uncheck" />
      {{/if}}
    </div>
    {{#if (and @user.hasEmailAuthenticationMethod (not @user.hasOnlyOneAuthenticationMethod))}}
      <PixButton
        class="user-authentication-method__remove-button"
        @triggerAction={{fn this.toggleDisplayRemoveAuthenticationMethodModal "EMAIL"}}
        data-test-remove-email
      >
        SUPPRIMER
      </PixButton>
    {{/if}}
  </div>
  <div class="user-authentication-method__item" data-test-username>
    <div class="user-authentication-method-item__label">
      <span>Identifiant</span>
      {{#if @user.hasUsernameAuthenticationMethod}}
        <FaIcon @icon="check-circle" class="user-authentication-method-item__check" />
      {{else}}
        <FaIcon @icon="times-circle" class="user-authentication-method-item__uncheck" />
      {{/if}}
    </div>
    {{#if (and @user.hasUsernameAuthenticationMethod (not @user.hasOnlyOneAuthenticationMethod))}}
      <PixButton
        class="user-authentication-method__remove-button"
        @triggerAction={{fn this.toggleDisplayRemoveAuthenticationMethodModal "USERNAME"}}
        data-test-remove-username
      >
        SUPPRIMER
      </PixButton>
    {{/if}}
  </div>
  <div class="user-authentication-method__item" data-test-pole-emploi>
    <div class="user-authentication-method-item__label">
      <span>Pôle Emploi</span>
      {{#if @user.hasPoleEmploiAuthenticationMethod}}
        <FaIcon @icon="check-circle" class="user-authentication-method-item__check" />
      {{else}}
        <FaIcon @icon="times-circle" class="user-authentication-method-item__uncheck" />
      {{/if}}
    </div>
    {{#if (and @user.hasPoleEmploiAuthenticationMethod (not @user.hasOnlyOneAuthenticationMethod))}}
      <PixButton
        class="user-authentication-method__remove-button"
        @triggerAction={{fn this.toggleDisplayRemoveAuthenticationMethodModal "POLE_EMPLOI"}}
        data-test-remove-pole-emploi
      >
        SUPPRIMER
      </PixButton>
    {{/if}}
  </div>
  <div class="user-authentication-method__item" data-test-mediacentre>
    <div class="user-authentication-method-item__label">
      <span>Médiacentre</span>
      {{#if @user.hasGARAuthenticationMethod}}
        <FaIcon @icon="check-circle" class="user-authentication-method-item__check" />
      {{else}}
        <FaIcon @icon="times-circle" class="user-authentication-method-item__uncheck" />
      {{/if}}
    </div>
    {{#if (and @user.hasGARAuthenticationMethod (not @user.hasOnlyOneAuthenticationMethod))}}
      <PixButton
        class="user-authentication-method__remove-button"
        @triggerAction={{fn this.toggleDisplayRemoveAuthenticationMethodModal "GAR"}}
        data-test-remove-mediacentre
      >
        SUPPRIMER
      </PixButton>
    {{/if}}
  </div>
</section>

<section class="page-section mb_10">
  <header class="page-section__header">
    <h2 class="page-section__title">Informations élèves SCO</h2>
  </header>

  <div class="schooling-registrations-table content-text content-text--small">
    <table class="table-admin">
      <thead>
        <tr>
          <th>Prénom</th>
          <th>Nom</th>
          <th>DDN</th>
          <th class="table__column--small">Classe</th>
          <th class="table__column--small">Orga ID</th>
          <th class="table__column--wide">Nom de l'orga</th>
          <th>Date d'import</th>
          <th>Dernière MAJ</th>
          <th>Actif</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{#each @user.schoolingRegistrations as |schoolingRegistration|}}
          <tr aria-label="Inscription">
            <td>{{schoolingRegistration.firstName}}</td>
            <td>{{schoolingRegistration.lastName}}</td>
            <td>{{format-date schoolingRegistration.birthdate}}</td>
            <td>{{schoolingRegistration.division}}</td>
            <td><LinkTo
                @route="authenticated.organizations.get"
                @model={{schoolingRegistration.organizationId}}
              >{{schoolingRegistration.organizationId}}</LinkTo></td>
            <td>{{schoolingRegistration.organizationName}}</td>
            <td>{{format-date schoolingRegistration.createdAt}}</td>
            <td>{{format-date schoolingRegistration.updatedAt}}</td>
            <td class="table-admin-schooling-registrations-status">
              {{#if schoolingRegistration.isDisabled}}
                <FaIcon
                  @icon="times-circle"
                  class="schooling-registrations-table__status--isDisabled"
                  aria-label="Inscription désactivée"
                />
              {{else}}
                <FaIcon
                  @icon="check-circle"
                  class="schooling-registrations-table__status--isEnabled"
                  aria-label="Inscription activée"
                />
              {{/if}}
            </td>
            <td>
              <PixButton
                @triggerAction={{fn this.toggleDisplayDissociateModal schoolingRegistration}}
                @size="small"
                @backgroundColor="red"
                data-test-dissociate-schooling-registration="{{schoolingRegistration.id}}"
              >
                Dissocier
              </PixButton>
            </td>
          </tr>
        {{else}}
          <tr>
            <td colspan="10" class="table-admin-empty">Aucun résultat</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</section>

<ConfirmPopup
  @message="Êtes-vous sûr de vouloir anonymiser cet utilisateur ? Ceci n’est pas réversible."
  @confirm={{this.anonymizeUser}}
  @cancel={{this.toggleDisplayAnonymizeModal}}
  @submitButtonType="danger"
  @show={{this.displayAnonymizeModal}}
/>

<ConfirmPopup
  @message="Êtes-vous sûr de vouloir dissocier cet élève ?"
  @title="Confirmer la dissociation"
  @submitTitle="Oui, je dissocie"
  @submitButtonType="danger"
  @confirm={{this.dissociate}}
  @cancel={{this.toggleDisplayDissociateModal}}
  @show={{this.displayDissociateModal}}
/>

<ConfirmPopup
  @message="Suppression de la méthode de connexion suivante : {{this.translatedType}}"
  @title="Confirmer la suppression"
  @submitTitle="Oui, je supprime"
  @confirm={{this.removeAuthenticationMethod}}
  @cancel={{this.toggleDisplayRemoveAuthenticationMethodModal}}
  @show={{this.displayRemoveAuthenticationMethodModal}}
/>