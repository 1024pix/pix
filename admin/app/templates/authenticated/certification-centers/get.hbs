{{! template-lint-disable require-input-label }}
{{page-title "Centre " @model.certificationCenter.id}}
<header class="page-header">
  <div class="page-title">
    <LinkTo @route="authenticated.certification-centers.list"><span id="link-to-certification-centers-page">Tous les
        centres de certification</span></LinkTo>
    <span class="wire">&nbsp;>&nbsp;</span>
    {{@model.certificationCenter.name}}
  </div>
</header>

<main class="page-body" id="certification-center-get-page">
  <section class="page-section mb_10">
    <div class="certification-center__data">
      <h1 class="certification-center__name">{{@model.certificationCenter.name}}</h1>

      {{#if this.isEditMode}}
        <div class="certification-center__edit-form">
          <form class="form" {{on "submit" this.updateCertificationCenter}}>

            <div class="form-field">
              <label for="type" class="form-field__label">Nom du centre</label>
              {{#if (v-get this.form 'name' 'isInvalid')}}
                <div class="form-field__error" aria-label="Message d'erreur du champ nom">
                  {{v-get this.form 'name' 'message'}}
                </div>
              {{/if}}
              <Input id="name"
                     @type="text"
                     class={{if (v-get this.form 'name' 'isInvalid') "form-control is-invalid" "form-control"}}
                     @value={{this.form.name}}
                     required={{true}} />
            </div>
            <div class="form-field">
              <label for="type" class="form-field__label">Type</label>
              {{#if (v-get this.form 'type' 'isInvalid')}}
                <div class="form-field__error" aria-label="Message d'erreur du champ type">
                  {{v-get this.form 'type' 'message'}}
                </div>
              {{/if}}
              <Input id="type"
                     @type="text"
                     class={{if (v-get this.form 'type' 'isInvalid') "form-control is-invalid" "form-control"}}
                     @value={{this.form.type}} />
            </div>
            <div class="form-field">
              <label for="externalId" class="form-field__label">Identifiant externe</label>
              {{#if (v-get this.form 'externalId' 'isInvalid')}}
                <div class="form-field__error" aria-label="Message d'erreur du champ identifiant externe">
                  {{v-get this.form 'externalId' 'message'}}
                </div>
              {{/if}}
              <Input id="externalId"
                     @type="text"
                     class={{if (v-get this.form 'externalId' 'isInvalid') "form-control is-invalid" "form-control"}}
                     @value={{this.form.externalId}} />
            </div>
            <div>
              <ul>
                {{#each @model.accreditations as |accreditation|}}
                  <li>
                    <label for="accreditation-checkbox">{{accreditation.name}}</label>
                    <Input
                      @type="checkbox"
                      @checked={{contains accreditation @model.certificationCenter.accreditations}}
                      {{on "input" (fn this.updateGrantedAccreditation accreditation)}}
                    />
                  </li>
                {{/each}}
              </ul>
            </div>
            <div class="form-actions">
              <PixButton
                      @size="small"
                      @backgroundColor="transparent-light"
                      @isBorderVisible={{true}}
                      @triggerAction={{this.cancel}}>Annuler</PixButton>
              <PixButton
                      @type="submit"
                      @size="small"
                      @backgroundColor="green"
                      @triggerAction={{this.toggleEditMode}}>Ajouter</PixButton>
            </div>
          </form>
        </div>
      {{else}}
        <p>
          Type : <span>{{@model.certificationCenter.type}}</span><br>
          Identifiant externe : <span>{{@model.certificationCenter.externalId}}</span><br>
        </p>
        <h3 class="certification-center__subtitle">Habilitations aux certifications complémentaires</h3>
        <ul>
          {{#each @model.accreditations as |accreditation|}}
            <li>
              {{#if (contains accreditation @model.certificationCenter.accreditations)}}
                <FaIcon class="granted-accreditation-icon" @icon="check-circle" />
              {{else}}
                <FaIcon class="not-granted-accreditation-icon" @icon="times-circle" />
              {{/if}}
              {{accreditation.name}}
            </li>
          {{/each}}
        </ul>
        <PixButton
                @backgroundColor="transparent-light"
                @isBorderVisible={{true}}
                @size="small"
                @triggerAction={{this.toggleEditMode}}
                aria-label="Editer">Editer</PixButton>
      {{/if}}
      <p>
        Type :
        <span>{{@model.certificationCenter.type}}</span><br />
        Identifiant externe :
        <span>{{@model.certificationCenter.externalId}}</span><br />
      </p>
      <h3 class="certification-center__subtitle">Habilitations aux certifications complémentaires</h3>
      <ul>
        {{#each @model.accreditations as |accreditation|}}
          <li>
            {{#if (contains accreditation @model.certificationCenter.accreditations)}}
              <FaIcon class="granted-accreditation-icon" @icon="check-circle" />
            {{else}}
              <FaIcon class="not-granted-accreditation-icon" @icon="times-circle" />
            {{/if}}
            {{accreditation.name}}
          </li>
        {{/each}}
      </ul>

    </div>
  </section>

  <section class="page-section mb_10">
    <header class="page-section__header">
      <h2 class="page-section__title">Ajouter un membre</h2>
    </header>

    <div class="certification-center__section">
      <Input
        id="userEmailToAdd"
        @type="email"
        @value={{this.userEmailToAdd}}
        aria-label="Adresse e-mail du nouveau membre"
        class="form-field__text form-control"
        placeholder="membre@inviter.net"
        {{on "focusout" this.updateEmailErrorMessage}}
      />

      <PixButton
        @triggerAction={{this.addCertificationCenterMembership}}
        @isDisabled={{this.isDisabled}}
        @size="small"
        aria-label="Ajouter le membre"
        data-test-add-membership
      >
        Valider
      </PixButton>
    </div>
    {{#if this.errorMessage}}
      <div class="certification-center__section error">
        {{this.errorMessage}}
      </div>
    {{/if}}
  </section>

  <CertificationCenterMembershipsSection @certificationCenterMemberships={{@model.certificationCenterMemberships}} />

</main>