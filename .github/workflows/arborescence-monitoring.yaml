name: "Arborescence monitoring"

on:
  push:
    branches:
      - dashboard-api-arborescence

defaults:
  run:
    shell: bash
    working-directory: api

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 16
      - name: "Run monitoring"
        id: monitoring
        env:
          BRANCH_NAME: ${{ github.ref_name }}
        run: |
          MONITORING=$(npm run monitoring:arborescence --silent)
          echo "${MONITORING}" >> $GITHUB_STEP_SUMMARY
          echo "MONITORING_RESULT=${MONITORING}" >> $GITHUB_ENV
      - name: "Notify Slack"
        id: notify
        env:
          WEBHOOK_URL: ${{ secrets.DASHBOARD_API_ARBORESCENCE_SLACK_WEBHOOK_URL }}
        run: |
          curl -X POST $WEBHOOK_URL -H 'Content-Type: application/json' -d "$MONITORING_RESULT"
