machine:
  node:
    version: 8

dependencies:
  pre:
    - sudo apt-get install build-essential
    - sudo apt-get install bcrypt
    - npm install -g bower
    - sudo -H pip install ansible==2.3.0 python-openstackclient
    - sudo -H pip install -U --ignore-installed setuptools shade

test:
  override:
    - npm run test:api

deployment:
  staging:
    branch: dev
    commands:
      - git config --global user.email 'jbuget@gmail.com'
      - git config --global user.name 'Jeremy Buget'
      - cd live && npm run deploy:staging
      - cd api && npm run deploy:staging

  integration:
    branch: /.*/
    commands:
      - git config --global user.email 'jbuget@gmail.com'
      - git config --global user.name 'Jeremy Buget'
      - cd api && npm run deploy:integration
      - cd live && npm run deploy:integration
      - ./live/scripts/signal_deploy_to_pr.sh

general:
  branches:
    ignore:
      - gh-pages
