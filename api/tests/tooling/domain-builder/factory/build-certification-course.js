import { CertificationCourse } from '../../../../lib/domain/models/CertificationCourse.js';
import { buildAssessment } from './build-assessment.js';
import { CertificationIssueReport } from '../../../../src/certification/shared/domain/models/CertificationIssueReport.js';
import { CertificationIssueReportCategory } from '../../../../src/certification/shared/domain/models/CertificationIssueReportCategory.js';

function buildCertificationCourse({
  id = 123,
  firstName = 'Gandhi',
  lastName = 'Matmatah',
  birthplace = 'Perpignan',
  birthdate = '1985-01-20',
  sex = 'F',
  birthPostalCode = '75005',
  birthINSEECode = null,
  birthCountry = 'FRANCE',
  createdAt = new Date('2020-01-01'),
  completedAt = new Date('2020-02-01'),
  externalId = 'externalId',
  examinerComment = 'A cass√© le clavier',
  hasSeenEndTestScreen = false,
  nbChallenges = 15,
  version = 1,
  isPublished = false,
  verificationCode = 'P-ABCD1234',
  assessment = buildAssessment({ certificationCourseId: this.id }),
  challenges = [],
  userId = 456,
  sessionId = 789,
  isCancelled = false,
  isRejectedForFraud = false,
  abortReason = null,
  complementaryCertificationCourses = [],
  maxReachableLevelOnCertificationDate = 7,
  numberOfChallenges = 20,
} = {}) {
  const certificationIssueReports = [];
  if (examinerComment && examinerComment !== '') {
    certificationIssueReports.push(
      new CertificationIssueReport({
        id: 159,
        certificationCourseId: id,
        category: CertificationIssueReportCategory.OTHER,
        description: examinerComment,
      }),
    );
  }

  return new CertificationCourse({
    id,
    firstName,
    lastName,
    birthdate,
    birthplace,
    birthPostalCode,
    birthINSEECode,
    birthCountry,
    sex,
    createdAt,
    completedAt,
    externalId,
    certificationIssueReports,
    hasSeenEndTestScreen,
    nbChallenges,
    version,
    isPublished,
    verificationCode,
    assessment,
    challenges,
    sessionId,
    userId,
    isRejectedForFraud,
    isCancelled,
    abortReason,
    complementaryCertificationCourses,
    maxReachableLevelOnCertificationDate,
    numberOfChallenges,
  });
}

buildCertificationCourse.unpersisted = function ({
  firstName = 'Gandhi',
  lastName = 'Matmatah',
  birthplace = 'Perpignan',
  birthdate = '1985-01-20',
  sex = 'F',
  birthPostalCode = '75005',
  birthINSEECode = null,
  birthCountry = 'FRANCE',
  createdAt = new Date('2020-01-01'),
  completedAt = new Date('2020-02-01'),
  externalId = 'externalId',
  hasSeenEndTestScreen = false,
  nbChallenges = 15,
  version = 1,
  isPublished = false,
  verificationCode = 'P-ABCD1234',
  assessment = buildAssessment({ certificationCourseId: this.id }),
  challenges = [],
  userId = 456,
  sessionId = 789,
  isCancelled = false,
  isRejectedForFraud = false,
  abortReason = null,
  complementaryCertificationCourses = [],
  maxReachableLevelOnCertificationDate = 7,
} = {}) {
  return new CertificationCourse({
    firstName,
    lastName,
    birthdate,
    birthplace,
    birthPostalCode,
    birthINSEECode,
    birthCountry,
    sex,
    createdAt,
    completedAt,
    externalId,
    certificationIssueReports: [],
    hasSeenEndTestScreen,
    nbChallenges,
    version,
    isPublished,
    verificationCode,
    assessment,
    challenges,
    sessionId,
    userId,
    isCancelled,
    isRejectedForFraud,
    abortReason,
    complementaryCertificationCourses,
    maxReachableLevelOnCertificationDate,
  });
};

export { buildCertificationCourse };
