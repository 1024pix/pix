# Glossaire des variables d'environnement
Ce tableau présente les différentes variables d'environnement utilisées sur nos applications.

Une explication est associée à chaque variable ainsi que leur utilisation (OUI / NON / OPT - OPTIONNELLE) en environnement :
* DEV — Développement
* INT — Intégration
* PROD — Production

### PIX API

| Variable                              | Description                                                                                                                                  | DEV      | INT      | PROD        | Si absente                                                      |
| ---                                   | ---                                                                                                                                          | ---      | ---      | ---         | ---                                                             |
| AIRTABLE_API_KEY                      | Clé d'API (secret) de connexion pour Airtable                                                                                                | OUI      | OUI      | OUI         | Pas de récupération du référentiel                              |
| AIRTABLE_BASE                         | Identifiant de la base Airtable ciblée                                                                                                       | OUI      | OUI      | OUI         | Pas de récupération du référentiel et des questions / réponses  |
| APPLICATION_NAME                      |                                                                                                                                              | OUI      | OUI      | OUI         | Variable inutilisée                                             |
| AUTH_SECRET                           | Sécurité d'authentification                                                                                                                  | OUI      | OUI      | OUI         |
| BASE_URL                              | URL utilisée par le script de rechargement de cache                                                                                          | OUI      | OUI      | OUI         |
| BUILDPACK_SUBDIR                      | Indique au `subdir-buildback` quel répertoire déployer                                                                                       | OUI      | OUI      | OUI         |
| BUILDPACK_URL                         | Indique à Scalingo quel `buildpack` utiliser. En principe https://github.com/1024pix/subdir-buildpack                                        | OUI      | OUI      | OUI         |
| CACHE_RELOAD_TIME                     | Période de rechargement du cache, utilisée par le script de rechargement de cache. Au format cron (ex. `5 8 * * *`)                          | OUI      | OUI      | OUI         |
| DATABASE_CONNECTION_POOL_MAX_SIZE     | Nombre de connexion simultanées maximum à la base de données (par conteneur)                                                                 | OUI      | OUI      | OUI         |
| DATABASE_SSL_ENABLED                  | Sécurisation SSL de la connexion à la base de données                                                                                        | OUI      | OUI      | OUI         |
| DATABASE_URL                          | Définit l'adresse, le port et le nom de la BDD PostgreSQL à utiliser. Sur Scalingo, on met contient `$SCALINGO_POSTGRESQL_URL`               | OUI      | OUI      | OUI         | Application KO                                                  |
| DAY_BEFORE_COMPETENCE_RESET_V2        | Nombre de jours nécessaires avant la remise à zéro d'une compétence en profil v2                                                             | OPT      | OUI      | OUI         | On utilise une valeur par défaut                                |
| INFLUXDB_SSL_CA_CERT                  | Certificat SSL pour Influx DB                                                                                                                | OUI      | OUI      | OUI         | Potentiellement inutilisé                                       |
| LOG_ENABLED                           | Activation de l'affichage des logs                                                                                                           | OPT      | OPT      | true        | Absence de logs                                                 |
| LOG_LEVEL                             | Niveau de détails affiché par les logs                                                                                                       | trace    | trace    | info        |
| MAILJET_KEY                           | Clef API pour MailJet                                                                                                                        | NON      | OUI      | OUI         | Pas d'envoi de mails à l'inscription / reset password           |
| MAILJET_SECRET                        | Secret de décryptage pour la clef API MailJet                                                                                                | NON      | OUI      | OUI         | Pas d'envoi de mails à l'inscription / reset password           |
| METRICS_DB_NAME                       | Nom de la base de données pour les Metrics Grafana                                                                                           | OUI      | OUI      | OUI         | Potentiellement inutilisé                                       |
| METRICS_DB_PASSWORD                   | Password de la base de données pour les Metrics Grafana                                                                                      | OUI      | OUI      | OUI         | Potentiellement inutilisé                                       |
| METRICS_DB_URL                        | Adresse URL de la base de données pour les Metrics Grafana                                                                                   | OUI      | OUI      | OUI         | Potentiellement inutilisé                                       |
| METRICS_DB_USER                       | Compte utilisateur de la base de données pour les Metrics Grafana                                                                            | OUI      | OUI      | OUI         | Potentiellement inutilisé                                       |
| NODE_ENV                              | Environnement Node reflétant l'environnement courant de l'API                                                                                | OUI      | OUI      | OUI         |
| NODE_OPTIONS                          | Options Node — utilisé ici pour définir son allocation mémoire autorisée                                                                     |          | staging  | production  |
| NPM_CONFIG_AUDIT                      | Peut être mis à `false` pour désactiver l'audit des packages NPM                                                                             |          | false    | false       |
| PAPERTRAIL_ENDPOINT                   | URL de Papertrail                                                                                                                            | OUI      | OUI      | OUI         |
| PGSSLMODE                             | Mode SSL pour PostgreSQL                                                                                                                     | require  | require  | require     |
| PIXMASTER_EMAIL                       | Compte utilisé par le script de rechargement de cache                                                                                        | OUI      | OUI      | OUI         |                                                                 |
| PIXMASTER_PASSWORD                    | Mot de passe du compte utilisé par le script de rechargement de cache                                                                        | OUI      | OUI      | OUI         |                                                                 |
| PORT                                  | Port TCP sur lequel l'API doit écouter en HTTP. Alimenté par Scalingo au démarrage d'un conteneur.                                           | OPT.     | NON      | NON         | Utilisation d'une valeur par défaut                             |
| REDIS_CACHE_KEY_LOCK_TTL              | Durée maximale de verrouillage du cache Redis                                                                                                | OUI      | OUI      | OUI         |
| REDIS_CACHE_LOCKED_WAIT_BEFORE_RETRY  | Délai d'attente avant nouvelle tentative d'accès à une clé Redis verrouillée                                                                 | OUI      | OUI      | OUI         |
| REDIS_URL                             | Adresse URL du cache Redis. Sur Scalingo, on met `$SCALINGO_REDIS_URL`                                                                       | OUI      | OUI      | OUI         |
| SAML_IDP_CONFIG                       | Configuration de l'IdP SAML (voir `api/scripts/make-saml-env.js`)                                                                            | OUI      | OUI      | OUI         |
| SENTRY_DSN                            | Adresse pour la collecte d'erreurs sur Sentry                                                                                                | OUI      | OUI      | OUI         |
| TEST_DATABASE_URL                     | Définit l'adresse, le port et le nom de la BDD PostgreSQL à utiliser pour les tests automatiques                                             | OUI      | NON      | NON         |
| TOKEN_LIFE_SPAN                       | Durée de vie du token de connexion. Exemple : `7d` pour 7 jours.                                                                             | OUI      | OUI      | OUI         |
| DD_API_KEY                      | Clé d'API (secret) de connexion pour Datadog                                                                                                | OUI      | OUI      | OUI         | Pas de connexion entre datadog et scalingo                       |                             
| DD_TOKEN                     | Token nécessaire  à la création du logs Drain, prenant la forme : `datadog://DD_API_KEY?region=REGION`                                                                                                | OUI      | OUI      | OUI         | Pas d'envoi de logs à Datadog                                                 |
| DD_SITE                      | Région de connexion pour Datadog                                                                                                | OUI      | OUI      | OUI         | Utilisation de la valeur par défaut : `datadoghq.com`            |                          

### PIX FRONT (app, orga, certif, admin)

| Variable                              | Description                                                                                                                                  | DEV      | INT      | PROD        | Si absente                                                      |
| ---                                   | ---                                                                                                                                          | ---      | ---      | ---         | ---                                                             |
| API_HOST_SUFFIX                       | Utilisée pour déterminer le nom de domaine où router les requêtes API                                                                        |          |          |             | scalingo.io                                                     |
